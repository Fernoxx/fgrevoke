<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarGuard SDK Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
            max-width: 800px;
            margin: 0 auto;
        }
        .log {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            border-left: 4px solid #666;
        }
        .log.success { border-left-color: #4ade80; }
        .log.error { border-left-color: #ef4444; }
        .log.warning { border-left-color: #f59e0b; }
        .log.info { border-left-color: #3b82f6; }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover { background: #2563eb; }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        .status.pending { background: #6b7280; }
        .status.success { background: #059669; }
        .status.error { background: #dc2626; }
        .status.warning { background: #d97706; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è FarGuard SDK Debug Tool</h1>
    <p>This page helps debug Farcaster SDK integration issues.</p>

    <div class="section">
        <h2>SDK Status</h2>
        <div id="sdk-status">
            <span class="status pending">Loading...</span>
        </div>
    </div>

    <div class="section">
        <h2>Manual Tests</h2>
        <button class="button" onclick="testReady()">Test sdk.actions.ready()</button>
        <button class="button" onclick="testMiniApp()">Test sdk.isInMiniApp()</button>
        <button class="button" onclick="testContext()">Test sdk.context</button>
        <button class="button" onclick="clearLogs()">Clear Logs</button>
    </div>

    <div class="section">
        <h2>Debug Logs</h2>
        <div id="logs"></div>
    </div>

    <script type="module">
        import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
        
        let logCount = 0;
        
        const log = (message, type = 'info') => {
            console.log(`[${type.toUpperCase()}] ${message}`);
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `${String(++logCount).padStart(3, '0')} | ${new Date().toLocaleTimeString()} | ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        };

        const updateStatus = (text, status = 'pending') => {
            const statusEl = document.getElementById('sdk-status');
            statusEl.innerHTML = `<span class="status ${status}">${text}</span>`;
        };

        // Global functions for manual testing
        window.testReady = async () => {
            try {
                log('üß™ Manual test: Calling sdk.actions.ready()...', 'info');
                await sdk.actions.ready();
                log('‚úÖ Manual test: sdk.actions.ready() completed successfully!', 'success');
            } catch (error) {
                log(`‚ùå Manual test: sdk.actions.ready() failed: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        };

        window.testMiniApp = async () => {
            try {
                log('üß™ Manual test: Calling sdk.isInMiniApp()...', 'info');
                const result = await sdk.isInMiniApp();
                log(`üì± Manual test: sdk.isInMiniApp() = ${result}`, result ? 'success' : 'warning');
            } catch (error) {
                log(`‚ùå Manual test: sdk.isInMiniApp() failed: ${error.message}`, 'error');
            }
        };

        window.testContext = async () => {
            try {
                log('üß™ Manual test: Getting sdk.context...', 'info');
                const context = await sdk.context;
                log(`üìä Manual test: sdk.context = ${JSON.stringify(context, null, 2)}`, 'success');
            } catch (error) {
                log(`‚ùå Manual test: sdk.context failed: ${error.message}`, 'error');
            }
        };

        window.clearLogs = () => {
            document.getElementById('logs').innerHTML = '';
            logCount = 0;
        };

        // Initialize
        log('üöÄ FarGuard SDK Debug Tool started', 'info');
        log(`User Agent: ${navigator.userAgent}`, 'info');
        log(`Location: ${window.location.href}`, 'info');
        
        // Check SDK availability
        log('üîç Checking SDK availability...', 'info');
        log(`SDK object type: ${typeof sdk}`, 'info');
        log(`SDK actions type: ${typeof sdk?.actions}`, 'info');
        log(`SDK ready function type: ${typeof sdk?.actions?.ready}`, 'info');

        if (sdk && sdk.actions && typeof sdk.actions.ready === 'function') {
            updateStatus('SDK Available', 'success');
            log('‚úÖ SDK is available and ready function exists', 'success');
            
            // Auto-test sequence
            setTimeout(async () => {
                log('üîÑ Starting automatic test sequence...', 'info');
                
                // Test 1: Check if in miniapp
                try {
                    const isInMiniApp = await sdk.isInMiniApp();
                    log(`üì± Auto-test: Is in MiniApp = ${isInMiniApp}`, isInMiniApp ? 'success' : 'warning');
                    
                    if (!isInMiniApp) {
                        updateStatus('Web Browser Mode', 'warning');
                        log('‚ö†Ô∏è Running in web browser - some features may not work', 'warning');
                    }
                } catch (error) {
                    log(`‚ùå Auto-test: isInMiniApp failed: ${error.message}`, 'error');
                }
                
                // Test 2: Try ready call
                try {
                    log('üìû Auto-test: Calling sdk.actions.ready()...', 'info');
                    await sdk.actions.ready();
                    log('‚úÖ Auto-test: sdk.actions.ready() completed successfully!', 'success');
                    updateStatus('SDK Ready Called Successfully', 'success');
                } catch (error) {
                    log(`‚ùå Auto-test: sdk.actions.ready() failed: ${error.message}`, 'error');
                    log(`Error details: ${JSON.stringify(error, null, 2)}`, 'error');
                    updateStatus('SDK Ready Call Failed', 'error');
                    
                    if (error.message && error.message.includes('not supported')) {
                        log('üí° This error is expected when running in a regular web browser', 'warning');
                    }
                }
                
                log('üèÅ Automatic test sequence completed', 'info');
            }, 1000);
            
        } else {
            updateStatus('SDK Not Available', 'error');
            log('‚ùå SDK is not available or ready function is missing', 'error');
        }
    </script>
</body>
</html>