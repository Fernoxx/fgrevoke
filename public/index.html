<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/farguard-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#7c3aed" />
    
    <title>FarGuard - Token Approval Manager</title>
    <meta name="description" content="Manage your token approvals securely on Farcaster. Track and revoke risky contract approvals to protect your wallet." />
    
    <!-- REQUIRED: Farcaster Frame Meta Tags -->
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://fgrevoke.vercel.app/farguard-logo.png" />
    <meta property="fc:frame:button:1" content="üõ°Ô∏è Open FarGuard" />
    <meta property="fc:frame:button:1:action" content="link" />
    <meta property="fc:frame:button:1:target" content="https://fgrevoke.vercel.app" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="FarGuard - Token Approval Manager" />
    <meta property="og:description" content="Manage your token approvals securely on Farcaster" />
    <meta property="og:image" content="https://fgrevoke.vercel.app/farguard-logo.png" />
    
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Safer Farcaster SDK Loading -->
    <script>
      // Prevent any uncaught errors from crashing the app
      window.addEventListener('error', function(e) {
        console.log('Caught error:', e.error);
        e.preventDefault();
      });
      
      window.addEventListener('unhandledrejection', function(e) {
        console.log('Caught rejection:', e.reason);
        e.preventDefault();
      });
      
      // Try to load SDK safely
      (function() {
        try {
          // Method 1: Try ESM import
          if (typeof window.import !== 'undefined') {
            import('https://esm.sh/@farcaster/miniapp-sdk').then(({ sdk }) => {
              window.sdk = sdk;
              window.farcasterSdk = sdk;
              console.log('‚úÖ SDK loaded via ESM');
              
              // Call ready after delay
              setTimeout(() => {
                if (sdk?.actions?.ready) {
                  sdk.actions.ready();
                  console.log('‚úÖ SDK ready() called');
                }
              }, 1000);
            }).catch(e => {
              console.log('ESM load failed:', e);
              loadFallbackSDK();
            });
          } else {
            loadFallbackSDK();
          }
        } catch (e) {
          console.log('SDK loading error:', e);
          loadFallbackSDK();
        }
        
        function loadFallbackSDK() {
          try {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/@farcaster/miniapp-sdk/dist/index.min.js';
            script.onload = function() {
              console.log('‚úÖ Fallback SDK loaded');
              setTimeout(() => {
                if (window.farcasterSdk?.actions?.ready) {
                  window.farcasterSdk.actions.ready();
                  console.log('‚úÖ Fallback SDK ready() called');
                }
              }, 1000);
            };
            script.onerror = function() {
              console.log('‚ùå All SDK loading methods failed');
            };
            document.head.appendChild(script);
          } catch (e) {
            console.log('Fallback SDK loading failed:', e);
          }
        }
      })();
    </script>
    
    <!-- Backup ready calls -->
    <script>
      // Multiple ready() attempts
      setTimeout(() => {
        if (window.sdk?.actions?.ready) {
          window.sdk.actions.ready();
          console.log('‚úÖ Backup ready() #1');
        }
      }, 2000);
      
      setTimeout(() => {
        if (window.sdk?.actions?.ready) {
          window.sdk.actions.ready();
          console.log('‚úÖ Backup ready() #2');
        }
      }, 5000);
      
      // PostMessage fallback
      setTimeout(() => {
        if (window.parent !== window) {
          try {
            window.parent.postMessage({ type: 'miniapp-ready' }, '*');
            console.log('‚úÖ PostMessage ready() sent');
          } catch (e) {
            console.log('PostMessage failed:', e);
          }
        }
      }, 3000);
    </script>
  </body>
</html>